<%= render ContentComponent.new(width: :large) do %>
  <div class="space-y-6 sm:flex sm:space-y-0 sm:gap-4">
    <%# Edit button %>
    <% if can? :update, @project %>
      <ul class="block sm:flex-grow w-full text-end sm:order-last whitespace-nowrap">
        <li class="inline-flex">
          <%= render ButtonComponent.new(tag: :a,
                                         href: edit_project_path(@project),
                                         scheme: :default,
                                         size: :small) do |edit_button| %>
            <span>Bearbeiten</span>
          <% end %>
        </li>
      </ul>
    <% end %>
    <%# Breadcrumb navigation %>
    <%= render BreadcrumbComponent.new do |breadcrumb| %>
      <% breadcrumb.section("Start", href: root_path, icon: :home) %>
      <% breadcrumb.section("Projekte", href: projects_path) %>
      <% breadcrumb.section(@project.title) %>
    <% end %>
  </div>



  <% if can? :update, @project %>
    <div class="mb-4">
      <% if @project.published? %>
        <%= render BadgeComponent.new("Veröffentlicht",
                                      scheme: :green,
                                      size: :medium) %>
      <% else %>
        <%= render BadgeComponent.new("Entwurf", scheme: :dark, size: :medium) %>
      <% end %>
      <% if @project.visible? %>
        <%= render BadgeComponent.new("Sichtbar",
                                      scheme: :green,
                                      size: :medium) %>
      <% else %>
        <%= render BadgeComponent.new("Unsichtbar", scheme: :dark, size: :medium) %>
      <% end %>

      <svg class="w-5 h-5 mb-0.5 text-gray-800 dark:text-white inline align-center" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" data-popover-target="popover-visibility-info">
        <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.529 9.988a2.502 2.502 0 1 1 5 .191A2.441 2.441 0 0 1 12 12.582V14m-.01 3.008H12M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
      </svg>

      <% if @project.published? && @project.tasks.present? && @project.tasks.any?(&:published?) %>
        <% headline = "Für alle sichtbar" %>
      <% else %>
        <% headline = "Nur für Ansprechpersonen sichtbar" %>
      <% end %>

      <div data-popover id="popover-visibility-info" role="tooltip" class="absolute z-10 invisible inline-block text-sm text-gray-500 transition-opacity duration-300 bg-white border border-gray-200 rounded-lg shadow-sm opacity-0 w-72 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-400 left-48">
        <div class="p-3 space-y-2">
          <h3 class="font-semibold text-gray-900 dark:text-white"><%= headline %></h3>
          <div class="grid grid-cols-2 gap-2">
            <% bg_color = @project.published? ? "bg-green-300 dark:bg-green-400" : "bg-gray-200 dark:bg-gray-600" %>
            <div class="h-1 <%= bg_color %>"></div>
            <% bg_color = (@project.tasks.present? && @project.tasks.any?(&:published?)) ? "bg-green-300 dark:bg-green-400" : "bg-gray-200 dark:bg-gray-600" %>
            <div class="h-1 <%= bg_color %>"></div>
          </div>
          <p>Eigenschaften:</p>
          <ul>
            <li class="flex items-center mb-1">
              <% if @project.published? %>
                <svg class="w-3.5 h-3.5 me-2 text-green-400 dark:text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
                </svg>
              <% else %>
                <svg class="w-3 h-3 me-2.5 text-gray-300 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
              <% end %>
              Projekt veröffentlicht
            </li>
            <li class="flex items-center">
              <% if @project.tasks.present? && @project.tasks.any?(&:published?) %>
                <svg class="w-3.5 h-3.5 me-2 text-green-400 dark:text-green-500" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 12">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5.917 5.724 10.5 15 1.5"/>
                </svg>
              <% else %>
                <svg class="w-3 h-3 me-2.5 text-gray-300 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                  <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                </svg>
              <% end %>
              1+ veröffentlichte Aufgaben
            </li>
          </ul>
        </div>
        <div data-popper-arrow></div>
      </div>
    </div>
  <% end %>

  <%# Project name %>
  <%= render HeadingComponent.new(tag: :h2, scheme: :secondary).with_content(@project.title) %>
  <%# Project description %>
  <% @project.description.split("\n").each do |paragraph| %>
    <p class="mb-6 text-lg font-normal text-gray-500 lg:text-xl dark:text-gray-400"><%= paragraph %></p>
  <% end %>


  <%= render HorizontalLineComponent.new %>

  <%# Contacts %>
  <%= render HeadingComponent.new(tag: :h3, scheme: :tertiary).with_content("Ansprechpersonen") %>
  <p class="mb-6 text-base font-normal text-gray-500 lg:text-lg dark:text-gray-400">Hier findest du die Ansprechpersonen für dieses Projekt. Wenn du Fragen hast, Unterstützung brauchst oder einfach nur ein paar Infos möchtest, kannst du sie direkt kontaktieren.</p>
  <%= render Modal::ContactListComponent.new(@project.coordinators) %>

  <%= render HorizontalLineComponent.new %>

  <%# Tasks %>
  <%= render HeadingComponent.new(tag: :h3, scheme: :tertiary).with_content("Aufgaben") %>
  <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
    <% @tasks.each do |task| %>
      <%= render TaskCardComponent.new(task) %>
    <% end %>
  </div>

  <%= render HorizontalLineComponent.new %>

  <div class="grid grid-cols-1 justify-center text-center">
    <%= render ButtonComponent.new(tag: :a,
                                   href: projects_path,
                                   scheme: :alternative,
                                   size: :large).with_content("Zur Projektübersicht") %>
  </div>
<% end %>
